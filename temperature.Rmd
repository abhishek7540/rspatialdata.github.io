---
title: "Temperature"
output:
  html_document:
    toc: true
    toc_float: true
    number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## The `WorldClim` database

[Worldclim](https://www.worldclim.org/) is a database of global interpolated climate data for global land areas, and provides aggregated historical climate data for the years 1970-2000.

WorldClim provides [monthly climate data](https://www.worldclim.org/data/worldclim21.html) for minimum, maximum and average temperatures, as well as precipitation, solar radiation, wind speed and water vapor pressure, at four spatial resolutions between 30 seconds (~1 km^2^) and 10 minutes (~340km^2^). A list of [19 bioclimatic variables](https://www.worldclim.org/data/bioclim.html) derived as an average of the monthly values for the years 1970-2000 are also provided as more biologically meaningful variables.

The `raster` R package provides access to the WorldClim database, and allows us to download data sets on the many different climatic conditions provided by WorldClim.

## Installing `raster`

The `raster` package can be directly installed from CRAN as follows

```{r install-raster, eval=FALSE}
install.packages("raster")
```

## Downloading maximum temperature data

We can then use `getData()` function of the `raster` package to download different climatic conditions from the Worldclim database.

The following example downloads the monthly maximum temperatures at a spatial resolution of 10 minutes (~340km^2^).

```{r download-maxtemp-data}
library(raster)
tmax_data <- getData(name = "worldclim", var = "tmax", res = 10)
```

## Understanding the downloaded data

The downloaded monthly maximum temperature data, will be a RasterStack object -  which is a collection of RasterLayer objects with the same spatial extent and resolution. This makes sense, because the monthly maximum temperature data should contain 12 RasterLayers for 12 months.

```{r print-maxtemp-data}
tmax_data
```

Note how each RasterLayer corresponding to the 12 months of the year are named from tmax1 - tmax12 respectively.

The minimum and maximum values for each month however don't seem practical. This is because the Worldclim temperature data set is stated to have a gain of 0.1, which means that it must be multiplied by 0.1 to convert back to degrees Celsius. 
```{r convert-maxtemp-to-celsius}
gain(tmax_data)=0.1
```

Thereafter, to extract the maximum temperature of a single month we can use the following approach. This example prints out the RasterLayer object corresponding to the maximum temperature in May - the fifth month of year.

```{r maxtemp-may-data}
tmax_data$tmax5
```

It might also be important to get an average of the monthly maximum temperature values, which can be done as follows. Note how the RasterStack object is converted to a RasterLayer object with a single set of values.

```{r calculate-mean-maxtemp}
tmax_mean <- mean(tmax_data)
tmax_mean
```

## Visualising the Maximum temperature data with `ggplot2`

The `ggplot2` package provides the `geom_raster()` function, which can be used to easily visualise the downloaded temperature.

The following example visualises the mean of the monthly maximum temperatures across the world. Before visualising the data, we first convert the RasterLayer object to a dataframe.

```{r visualise-mean-maxtemp}
# install.packages(c("ggplot2", "magrittr"))
library(ggplot2)
library(magrittr)

tmax_mean_df <- as.data.frame(tmax_mean, xy = TRUE, na.rm = TRUE)

tmax_mean_df %>%
  ggplot(aes(x=x,y=y)) +
  geom_raster(aes(fill = layer)) +
  labs(title = "Mean monthly maximum temperatures",
       subtitle = "For the years 1970-2000") +
  xlab("Longitude") +
  ylab("Latitude") +
  scale_fill_continuous(name = "Temperature (°C)")
```

## Examples

### Visualising bioclimatic variables

The list of 19 bioclimatic variables provided by the Worldclim database are derived from the monthly values, in order to generate more biologically meaningful variables.

The complete list of variables and their codes can be found [here](https://www.worldclim.org/data/bioclim.html)

The process of downloading and visualising these variables follows a similar approach to the tutorial, and the following is a complete example of downloading and visualising the "Maximum Temperature of the Warmest Month".


```{r warmest-month-maxtemp-example}
# install.packages(c("raster", "ggplot2", "magrittr"))
library(raster)
library(ggplot2)
library(magrittr)

bio <- getData(name = "worldclim", var = "bio", res = 10)
gain(bio)=0.1

bio5_df <- as.data.frame(bio$bio5, xy = TRUE, na.rm = TRUE)

bio5_df %>%
  ggplot(aes(x=x,y=y)) +
  geom_raster(aes(fill = bio5))  +
  labs(title = "Maximum Temperature of the Warmest Month",
       subtitle = "In the time period 1970-2000") +
  xlab("Longitude") +
  ylab("Latitude") +
  scale_fill_continuous(name = "Temperature (°C)")
```


## References

- `WorldClim` website: https://worldclim.org/data/index.html  
- `raster` package documentation: https://www.rdocumentation.org/packages/raster/versions/3.4-5
